# PentestingNote
一些渗透测试技巧的个人（Enomothem or 伊诺）记录笔记

## 目录

<!-- MarkdownTOC depth=4 -->

- [网络层面](#网络层面)
  - [基础](#基础)
  - [工具](#工具)
- [渗透测试](#渗透测试)
  - [信息收集](#信息收集) 
  - [漏洞挖掘](#漏洞挖掘) 
  - [内网和域](#内网和域) 
  - [权限提升](#权限提升) 
  - [清理脚印](#清理脚印) 
  - [撰写报告](#撰写报告) 
- [伊诺之令](#命令笔记)
  - [Windows](#Windows)
  - [Linux](#Linux)
- [逆向工程](#逆向工程)
  - [学习](#学习)
  - [工具](#工具)

<!-- /MarkdownTOC -->

## 网络层面

### 基础
#### OSI参考模型及其相关协议RFC
应用层 | Application Layer
 * [FTP](https://www.rfc-editor.org/rfc/rfc959.txt) - File Transfer Protocol 文本传输协议 RFC959
 * [SMTP](https://www.rfc-editor.org/rfc/rfc821.txt) - Simple Mail Transfer Protocol 简单邮件传输协议 RFC821
 * [HTTP1.0](https://www.rfc-editor.org/rfc/rfc1945.txt) - Hypertext Transfer Protocol version 1.0 超文本传输协议1.0 RFC1945
 * [HTTP1.1](https://www.rfc-editor.org/rfc/rfc2616.txt) - Hypertext Transfer Protocol version 1.1 超文本传输协议1.1 RFC2616、2617
 * [HTML](https://www.rfc-editor.org/rfc/rfc1866.txt) - Hypertext Markup Language version 2.0 超文本标记语言2.0 RFC1866
 * [RIP](http://www.rfc-editor.org/rfc/rfc1058.txt) - Routing Information Protocol 路由信息协议 RFC1058、1923
 * [RIP2.0](https://www.rfc-editor.org/rfc/rfc1387.txt) - Routing Information Protocol version 2.0 路由信息协议2.0 RFC1387 etc
 * [DNS](https://www.rfc-editor.org/rfc/rfc881.txt) - Domain Name System 域名解析系统 RFC881 etc

传输层 | Transport Layer
 * [TCP](https://www.rfc-editor.org/rfc/rfc793.txt) - Transport Control Protocol 传输控制协议 RFC793
 * [UDP](https://www.rfc-editor.org/rfc/rfc768.txt) - User Datagram Protocol 用户数据报协议 RFC768

网络层 | Netword Layer
 * [IP](https://www.rfc-editor.org/rfc/rfc791.txt) - Internet Protocol 网际协议 RFC791
 * [IPv6](https://www.rfc-editor.org/rfc/rfc2460.txt) - Internet Protocol Version 6 IPv6 RFC2460
 * [ICMP](https://www.rfc-editor.org/rfc/rfc777.txt) - Internet Control Message Protocol Internet控制报文协议 RFC777、792
 * [OSPF](https://www.rfc-editor.org/rfc/rfc1245.txt) - Open Shortest Path First 开放式最短路径优先 RFC1245、1246

数链层 | Data Link Layer
 * [ARP](https://www.rfc-editor.org/rfc/rfc826.txt) -  Address Resolution Protocol 地址解析协议 RFC826
 * [RARP](https://www.rfc-editor.org/rfc/rfc903.txt) - Reverse Address Resolution Protocol 反向地址转换协议 RFC903

物理层 | Physical Layer
 * [Ethernet_II](https://www.rfc-editor.org/rfc/rfc894.txt) - EthernetII Xerox制定 RFC894
 * [IEEE 802.3](https://www.rfc-editor.org/rfc/rfc1042.txt) - IEEE 802.3 IEEE 802委员会制定 RFC1042

> 注意：协议和应用是不同的，协议是由国际互联网工程任务组维护的，全世界根据协议的标准制定不同的设备以及软件达到互通的目的，就如Xshell只是应用，ssh是协议；Chrome、Firefox是应用，HTTP是协议，注意区分。


### 工具
 * [Wireshark](https://www.wireshark.org/) - 免费开源的流量包分析工具
 * [NetworkMiner](http://www.netresec.com/?page=NetworkMiner) - 网络取证分析工具
 * [tcpdump](http://www.tcpdump.org/) - 功能强大的命令行流量包分析工具，自带的libpcap用于网络流量捕获的便携式C/C++库
 * [Paros](http://sourceforge.net/projects/paros/) - 基于Java的HTTP/HTTPS代理用于评估Web应用程序漏洞工具
 * [pig](https://github.com/rafael-santiago/pig) - Linux下伪造流量包工具
 * [ZAP](https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project) - ZAP是用于发现Web应用程序中漏洞易于使用的集成式渗透测试工具
 * [mitmproxy](https://mitmproxy.org/) - 基于HTTP具有交互式控制界面并支持SSL中间代理的工具
 * [mitmsocks4j](https://github.com/Akdeniz/mitmsocks4j) - 基于Java支持中间SOCKS代理工具
 * [nmap](https://nmap.org/) - Nmap安全扫描工具
 * [Aircrack-ng](http://www.aircrack-ng.org/) - 用于破解802.11 WEP和WPA-PSK密钥工具
 * [Charles Proxy](https://charlesproxy.com) - 用于查看截获的HTTP和HTTPS/SSL实时流量的跨平台图形化用户界面Web调试代理工具
 * [Nipe](https://github.com/GouveaHeitor/nipe) - 使Tor网络成为默认网关的脚本


## 渗透测试
> 这里只提供思路，具体的学习还需深入，扎根最基础的学习中去，才能明白千篇一律的工具是怎么实现的。
### 信息收集
 * 真实IP地址、域名、子域名、端口、目录、后台、泄露信息、CMS、WAF
 * Google、Baidu、Yandex、社交平台
 * 钓鱼、社工、客服、蜜罐
### 漏洞挖掘
 * 浏览网站，看看网站规模，功能，特点等
 * 端口，弱口令，目录等扫描，对响应的端口进行漏洞探测，比如 rsync,心脏出血，mysql,ftp,ssh弱口令等。
 * XSS，SQL注入，上传，命令注入，CSRF，cookie安全检测，敏感信息，通信数据传输，暴力破解。
 * 任意文件上传/下载，越权访问，未授权访问，目录遍历，文件 包含，重放攻击（短信轰炸），服务器漏洞检测，最后使用漏扫工具等。
### 内网和域
 * 内网收集。用户、进程、端口、服务、补丁、共享、备忘录、密码、无线信息。
 * 横向渗透。注意开放端口。
 * 域渗透。收集域内信息，寻找域控，SPN扫描，Kerberos漏洞，抓取哈希，域账号破解，获取黄金票据，AD持久化，Exchange利用等
### 权限提升
 * Linux：内核漏洞（脏牛、下水管）、计划任务、SUID、错误配置、密码泄露等。
 * Windows：BypassUAC、令牌窃取、内核溢出漏洞等
### 清理脚印
a 3389登陆记录清除
```
@echo off
@reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f
@del "%USERPROFILE%\My Documents\Default.rdp" /a
@exit
```
b Metasploit
```
# run clearlogs 
# clearev
```
c Windows日志的删除
获取日志分类功能
`# wevtutil el >1.txt`
获取单个日志类别的统计信息,例如：
`# wevtutil gli "windows powershell"`
查看指定日志的具体内容
`# wevtutil qe /f:text "windows powershell"`
删除单个日志类别的所有信息
`# wevtutil cl "windows powershell"`
d 工具
 * Invoke-Phant0m
 * Windwos-EventLog-Bypass

### 撰写报告
 * 规范。目标、受众、时间、密级、分发。
 * 收集信息。自己渗透成功的利用证明、截图（帮助技术人员复现）、脚本（向技术人员提供细节，可以是自己编写的）、日志记录（最好是数字形式显示，方便展示）
 * 封面。正式一点、项目标题、客户名称、版本、作者信息、日期。
 * 属性。客户信息、测试的公司、测试的人员、有关人员和其他有关参与人员信息
 * 报告索引。列出主要标题的索引，下级标题也列出（下级可以不需要页码），图目录列出图像的页码索引。
 * 行动纲要。这是为高层书写的，简要说明渗透测试过程。包括项目目标、项目范围、授权信息、明确渗透测试者的假定（保护测试者）、时间表、渗透测试摘要。
 * 发现问题的清单。以表格的形式列举便于查询。
 * 发现问题的详细说明。包含修复建议（帮助IT、运维、信息安全人员阅读）、漏洞定义节、脆弱性节、概念验证（给出成功的截图就行了）、可能性（解释漏洞利用的条件）、风险评估、建议。
 * 支持文档。方法学、工具（渗透测试所用工具）、附录（非必须阅读的内容）、参考（无法描述细节或时间不够写）、术语表。
 * 质量保证。给客户保证渗透测试的质量有效，没有错误。值得信赖！
## 伊诺之令
本人在渗透测试中收集的命令，以及经过改良的绝妙之令——伊诺之令。以极致的手法，击穿WAF之壁，来无影去无踪，渗而不透，此乃终端之令法。
### Windows
#### 列出WIFI配置信息

`for /f "skip=9 tokens=1,2 delims=:" %i in ('netsh wlan show profiles') do @echo %j | findstr -i -v echo | netsh wlan show profiles %j key=clear`
### Linux
#### "渗不透"
-在使用命令前加上反斜杠防止执行改名后的命令进入陷阱，可以忽略掉 alias 的指定选项  
-在输入命令时，全面加上空格将不记录命令历史，不过在此之前要看一下环境变量。  
`#[空格]\history`   # 这就是“渗不透”，将两者结合，既不留下脚印，又不会踩雷。  


<!-- 逆向工程类 -->

## 逆向工程
### 免杀
 * 冰蝎Java WebShell免杀生成 https://github.com/Tas9er/ByPassBehinder4J
 * 哥斯拉冰蝎 Webshell免杀 https://github.com/czz1233/GBByPass
 * Bypass Applocker
 * UltimateAppLockerByPassList https://github.com/api0cradle/UltimateAppLockerByPassList
 * BypassAV
 * Empire、PEspin、Shellter、Ebowla、Veil、PowerShell、Python、Go
### 学习
 * [refer](https://github.com/gh0stkey/Binary-Learning)
### 工具
 * [nudge4j](https://github.com/lorenzoongithub/nudge4j) - 让浏览器与JVM交互的Java工具
 * [IDA](https://www.hex-rays.com/products/ida/) - IDA是可以工作在Windows，Linux或Mac OS X的多处理反汇编和调试工具
 * [OllyDbg](http://www.ollydbg.de/) - Windows 32位汇编程序级别调试工具
 * [x64dbg](http://x64dbg.com/) - Windows上开源x64/x32调试工具
 * [dex2jar](https://github.com/pxb1988/dex2jar) - 用于处理用于处理Android .dex和Java .class文件的工具
 * [JD-GUI](http://jd.benow.ca/) - 显示Java源代码“.class”文件的独立图形实用工具
 * [procyon](https://bitbucket.org/mstrobel/procyon/wiki/Java%20Decompiler) - 现代化开源Java反编译工具
 * [androguard](https://code.google.com/p/androguard/) - 用于Android应用程序的逆向工程，恶意软件分析工具
 * [JAD](http://varaneckas.com/jad/) - JAD Java反编译工具(闭源, 不常更新)
 * [dotPeek](https://www.jetbrains.com/decompiler/) - JetBrains公司开发的免费的.NET反编译工具
 * [ILSpy](https://github.com/icsharpcode/ILSpy/) - 开源的集浏览和反编译.NET程序工具
 * [dnSpy](https://github.com/0xd4d/dnSpy) - 集编辑，反编译和调试.NET程序工具
 * [de4dot](https://github.com/0xd4d/de4dot) - 破解.NET程序工具
 * [antinet](https://github.com/0xd4d/antinet) - 用于反编译和混淆代码的.NET程序工具
 * [UPX](http://upx.sourceforge.net/) - 终极封装可执行文件工具
 * [radare2](https://github.com/radare/radare2) - 便携式的逆向工程框架工具
 * [plasma](https://github.com/joelpx/plasma) - 适用于x86/ARM/MIPS交互式反汇编，使用花指令语法代码生成伪代码。
 * [Hopper](https://www.hopperapp.com) - 适用于OS X和Linux反汇编/反编译32/64位Windows/MAC/LINUX/iOS的可执行文件工具
 * [ScratchABit](https://github.com/pfalcon/ScratchABit) - 使用IDAPython兼容插件API轻松重新定位和可攻击的交互式反汇编工具
refer:[L](https://github.com/Lucifer1993/awesome-hacking)


## 参考以下大佬表哥圈子里的家人们的笔记
[1] https://github.com/Lucifer1993/awesome-hacking - 参考关键工具向
